<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STMS - School Transportation Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="../CSS[Files]/style[login/admin dashboard.css" />
</head>

<body>
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="p-6">
            <div class="flex items-center space-x-3 mb-0">
        - <img src="./assets/PNG[assets]/main_logo[trans].png" alt="Bus Logo" class="lg">
                - <div>
                    - <h1 class="text-white font-bold text-xl">STMS</h1>
                    - <p class="text-gray-300 text-sm">Transportation System</p>
                </div>
        </div>
    </div>

    <nav class="px-4 pb-4">
        <div class="nav-item active text-white space-x-3" onclick="showSection('dashboard')">
            <i data-feather="home" class="w-5 h-5"></i>
            <span>Dashboard</span>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('fleet')">
            <i data-feather="truck" class="w-5 h-5"></i>
            <span>Fleet Management</span>
            <div class="notification-badge ml-auto">5</div>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('routes')">
            <i data-feather="map" class="w-5 h-5"></i>
            <span>Route Planning</span>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('students')">
            <i data-feather="users" class="w-5 h-5"></i>
            <span>Student Management</span>
            <div class="notification-badge ml-auto">12</div>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('drivers')">
            <i data-feather="user-check" class="w-5 h-5"></i>
            <span>Driver Management</span>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('parents')">
            <i data-feather="heart" class="w-5 h-5"></i>
            <span>Parent Portal</span>
            <div class="notification-badge ml-auto">3</div>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('schedule')">
            <i data-feather="calendar" class="w-5 h-5"></i>
            <span>Today's Schedule</span>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('attendance')">
            <i data-feather="check-circle" class="w-5 h-5"></i>
            <span>Attendance</span>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('analytics')">
            <i data-feather="bar-chart-2" class="w-5 h-5"></i>
            <span>Analytics</span>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('reports')">
            <i data-feather="file-text" class="w-5 h-5"></i>
            <span>Reports</span>
        </div>

        <div class="nav-item text-gray-300 space-x-3" onclick="showSection('settings')">
            <i data-feather="settings" class="w-5 h-5"></i>
            <span>Settings</span>
        </div>
    </nav>

    <div class="absolute bottom-4 left-4 right-4">
        <div class="nav-item flex items-center space-x-3 p-3 text-gray-300" onclick="logout()">
            <i data-feather="log-out" class="w-5 h-5"></i>
            <span>Logout</span>
        </div>
    </div>
    </div>

    <!-- Main Content -->
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4 sticky top-0 z-40">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="toggleSidebar()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-feather="menu" class="w-6 h-6"></i>
                    </button>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" id="pageTitle">Dashboard Overview</h2>
                        <p class="text-gray-600" id="pageSubtitle">Welcome back, Administrator</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <div class="relative hidden md:block">
                        <i data-feather="search"
                            class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"></i>
                        <input type="text" placeholder="Search..."
                            class="pl-10 pr-4 py-2 bg-gray-100 border-0 rounded-lg w-64 focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                    </div>

                    <!-- Notifications -->
                    <div class="relative">
                        <button class="p-2 rounded-lg hover:bg-gray-100 transition-colors relative"
                            onclick="toggleNotifications()">
                            <i data-feather="bell" class="w-5 h-5"></i>
                            <div class="notification-badge">7</div>
                        </button>
                    </div>

                    <!-- Profile -->
                    <div class="flex items-center space-x-3">
                        <div
                            class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center">
                            <span class="text-white font-semibold">AD</span>
                        </div>
                        <div class="hidden md:block">
                            <p class="text-sm font-semibold text-gray-800">Administrator</p>
                            <p class="text-xs text-gray-600">System Admin</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="p-6">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="space-y-6">
                <!-- Key Metrics -->
                <div class="grid-4">
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Active Buses</p>
                                <p class="text-3xl font-bold text-gray-800" id="activeBuses">24</p>
                                <p class="text-green-600 text-sm flex items-center mt-1">
                                    <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                    +2 from yesterday
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                                <i data-feather="truck" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Students Transported</p>
                                <p class="text-3xl font-bold text-gray-800" id="studentsCount">1,247</p>
                                <p class="text-blue-600 text-sm flex items-center mt-1">
                                    <i data-feather="users" class="w-4 h-4 mr-1"></i>
                                    98.5% attendance
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                <i data-feather="users" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">On-Time Performance</p>
                                <p class="text-3xl font-bold text-gray-800" id="onTimePerf">94.2%</p>
                                <p class="text-green-600 text-sm flex items-center mt-1">
                                    <i data-feather="clock" class="w-4 h-4 mr-1"></i>
                                    +1.2% this week
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center">
                                <i data-feather="clock" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Fuel Efficiency</p>
                                <p class="text-3xl font-bold text-gray-800" id="fuelEff">8.2 MPG</p>
                                <p class="text-red-600 text-sm flex items-center mt-1">
                                    <i data-feather="trending-down" class="w-4 h-4 mr-1"></i>
                                    -0.3 from last month
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-red-500 to-red-600 rounded-xl flex items-center justify-center">
                                <i data-feather="zap" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
                    <div class="grid-4">
                        <button class="btn-primary flex flex-col items-center p-4 rounded-lg"
                            onclick="openModal('addBusModal')">
                            <i data-feather="plus-circle" class="w-8 h-8 mb-2"></i>
                            <span>Add Bus</span>
                        </button>
                        <button class="btn-success flex flex-col items-center p-4 rounded-lg"
                            onclick="openModal('addRouteModal')">
                            <i data-feather="map-pin" class="w-8 h-8 mb-2"></i>
                            <span>New Route</span>
                        </button>
                        <button class="btn-primary flex flex-col items-center p-4 rounded-lg"
                            onclick="openModal('addDriverModal')">
                            <i data-feather="user-plus" class="w-8 h-8 mb-2"></i>
                            <span>Add Driver</span>
                        </button>
                        <button class="btn-warning flex flex-col items-center p-4 rounded-lg"
                            onclick="openModal('maintenanceModal')">
                            <i data-feather="tool" class="w-8 h-8 mb-2"></i>
                            <span>Maintenance</span>
                        </button>
                    </div>
                </div>

                <!-- Charts and Map -->
                <div class="grid-2">
                    <!-- Performance Chart -->
                    <div class="card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Performance Trends</h3>
                            <select class="text-sm border border-gray-300 rounded-lg px-3 py-1">
                                <option>Last 7 days</option>
                                <option>Last 30 days</option>
                                <option>Last 3 months</option>
                            </select>
                        </div>
                        <div style="height: 300px; position: relative;">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>

                    <!-- Live Fleet Map -->
                    <div class="card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Live Fleet Tracking</h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                <span class="text-sm text-gray-600">Live</span>
                            </div>
                        </div>
                        <div id="liveMap" style="height: 400px; width: 100%; border-radius: 8px;"></div>
                    </div>
                </div>

                <!-- Alerts and Status -->
                <div class="grid-2">
                    <!-- Active Alerts -->
                    <div class="card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Active Alerts</h3>
                            <button class="text-sm text-blue-600 hover:text-blue-800">View All</button>
                        </div>
                        <div class="space-y-3" id="alertsList">
                            <div class="alert alert-danger">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start space-x-3">
                                        <i data-feather="alert-triangle" class="w-5 h-5 text-red-500 mt-0.5"></i>
                                        <div>
                                            <p class="font-medium">Bus #12 - Engine Warning</p>
                                            <p class="text-sm text-gray-600">Route 5A - Requires immediate attention</p>
                                            <p class="text-xs text-gray-500">2 minutes ago</p>
                                        </div>
                                    </div>
                                    <button class="text-blue-600 hover:text-blue-800 text-sm"
                                        onclick="resolveAlert(this)">Resolve</button>
                                </div>
                            </div>

                            <div class="alert alert-warning">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start space-x-3">
                                        <i data-feather="clock" class="w-5 h-5 text-yellow-500 mt-0.5"></i>
                                        <div>
                                            <p class="font-medium">Route 3B - Delayed</p>
                                            <p class="text-sm text-gray-600">15 minutes behind schedule due to traffic
                                            </p>
                                            <p class="text-xs text-gray-500">8 minutes ago</p>
                                        </div>
                                    </div>
                                    <button class="text-blue-600 hover:text-blue-800 text-sm"
                                        onclick="resolveAlert(this)">Update</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fleet Status -->
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Fleet Status Overview</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="status-indicator status-online"></div>
                                    <span class="font-medium">Active Routes</span>
                                </div>
                                <span class="text-2xl font-bold text-green-600">18</span>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="status-indicator status-maintenance"></div>
                                    <span class="font-medium">In Maintenance</span>
                                </div>
                                <span class="text-2xl font-bold text-yellow-600">4</span>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="status-indicator status-offline"></div>
                                    <span class="font-medium">Out of Service</span>
                                </div>
                                <span class="text-2xl font-bold text-red-600">2</span>
                            </div>

                            <div class="mt-4">
                                <div class="flex justify-between text-sm text-gray-600 mb-2">
                                    <span>Fleet Utilization</span>
                                    <span>87%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-gradient-to-r from-green-500 to-green-600"
                                        style="width: 87%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fleet Management Section -->
            <div id="fleetSection" class="hidden space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-800">Fleet Management</h2>
                    <div class="flex space-x-3">
                        <button class="btn-success" onclick="openModal('maintenanceScheduleModal')">
                            <i data-feather="tool" class="w-4 h-4 mr-2"></i>
                            Schedule Maintenance
                        </button>
                        <button class="btn-primary" onclick="openModal('addBusModal')">
                            <i data-feather="plus" class="w-4 h-4 mr-2"></i>
                            Add New Bus
                        </button>
                    </div>
                </div>

                <!-- Fleet Statistics -->
                <div class="grid-4">
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Total Fleet</p>
                                <p class="text-3xl font-bold text-gray-800">28</p>
                                <p class="text-blue-600 text-sm flex items-center mt-1">
                                    <i data-feather="truck" class="w-4 h-4 mr-1"></i>
                                    All buses
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                <i data-feather="truck" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Active Buses</p>
                                <p class="text-3xl font-bold text-green-600">24</p>
                                <p class="text-green-600 text-sm flex items-center mt-1">
                                    <i data-feather="check-circle" class="w-4 h-4 mr-1"></i>
                                    85.7% utilization
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                                <i data-feather="check-circle" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">In Maintenance</p>
                                <p class="text-3xl font-bold text-yellow-600">3</p>
                                <p class="text-yellow-600 text-sm flex items-center mt-1">
                                    <i data-feather="tool" class="w-4 h-4 mr-1"></i>
                                    Scheduled service
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center">
                                <i data-feather="tool" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Out of Service</p>
                                <p class="text-3xl font-bold text-red-600">1</p>
                                <p class="text-red-600 text-sm flex items-center mt-1">
                                    <i data-feather="x-circle" class="w-4 h-4 mr-1"></i>
                                    Needs repair
                                </p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-red-500 to-red-600 rounded-xl flex items-center justify-center">
                                <i data-feather="x-circle" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fleet Actions -->
                <div class="card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Fleet Actions</h3>
                    <div class="grid-4">
                        <button class="btn-primary flex flex-col items-center p-4 rounded-lg"
                            onclick="performFleetAction('inspection')">
                            <i data-feather="search" class="w-8 h-8 mb-2"></i>
                            <span>Fleet Inspection</span>
                        </button>
                        <button class="btn-success flex flex-col items-center p-4 rounded-lg"
                            onclick="performFleetAction('fuel')">
                            <i data-feather="zap" class="w-8 h-8 mb-2"></i>
                            <span>Fuel Report</span>
                        </button>
                        <button class="btn-warning flex flex-col items-center p-4 rounded-lg"
                            onclick="performFleetAction('maintenance')">
                            <i data-feather="tool" class="w-8 h-8 mb-2"></i>
                            <span>Maintenance Log</span>
                        </button>
                        <button class="btn-primary flex flex-col items-center p-4 rounded-lg"
                            onclick="performFleetAction('gps')">
                            <i data-feather="map-pin" class="w-8 h-8 mb-2"></i>
                            <span>GPS Tracking</span>
                        </button>
                    </div>
                </div>

                <!-- Fleet Table -->
                <div class="card">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold">Fleet Overview</h3>
                            <div class="flex items-center space-x-3">
                                <input type="text" placeholder="Search buses..."
                                    class="px-3 py-2 border border-gray-300 rounded-lg text-sm" id="fleetSearch">
                                <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm" id="fleetFilter">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bus ID
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">License
                                        Plate</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Route
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Driver
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Capacity
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fuel
                                        Level</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Last
                                        Maintenance</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="fleetTable">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">Bus #001</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">ABC-1234</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 5A</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Mike Johnson</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">45/72</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-green-500 h-2 rounded-full" style="width: 78%"></div>
                                            </div>
                                            <span class="text-sm text-gray-600">78%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-15</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editBus('Bus #001')">Edit</button>
                                        <button class="text-green-600 hover:text-green-800 mr-3"
                                            onclick="trackBus('Bus #001')">Track</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="removeBus('Bus #001')">Remove</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">Bus #002</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">DEF-5678</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 3B</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Sarah Davis</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">38/72</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 45%"></div>
                                            </div>
                                            <span class="text-sm text-gray-600">45%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-10</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editBus('Bus #002')">Edit</button>
                                        <button class="text-green-600 hover:text-green-800 mr-3"
                                            onclick="trackBus('Bus #002')">Track</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="removeBus('Bus #002')">Remove</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">Bus #003</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">GHI-9012</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 8C</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Robert Wilson</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">52/72</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">Maintenance</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-red-500 h-2 rounded-full" style="width: 15%"></div>
                                            </div>
                                            <span class="text-sm text-gray-600">15%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-20</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editBus('Bus #003')">Edit</button>
                                        <button class="text-green-600 hover:text-green-800 mr-3"
                                            onclick="trackBus('Bus #003')">Track</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="removeBus('Bus #003')">Remove</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">Bus #004</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">JKL-3456</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 2A</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Lisa Anderson</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">41/72</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-green-500 h-2 rounded-full" style="width: 92%"></div>
                                            </div>
                                            <span class="text-sm text-gray-600">92%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-08</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editBus('Bus #004')">Edit</button>
                                        <button class="text-green-600 hover:text-green-800 mr-3"
                                            onclick="trackBus('Bus #004')">Track</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="removeBus('Bus #004')">Remove</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">Bus #005</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">MNO-7890</td>
                                    <td class="px-6 py-4 whitespace-nowrap">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">0/72</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">Out of
                                            Service</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-gray-400 h-2 rounded-full" style="width: 0%"></div>
                                            </div>
                                            <span class="text-sm text-gray-600">0%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-05</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editBus('Bus #005')">Edit</button>
                                        <button class="text-gray-400 cursor-not-allowed mr-3">Track</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="removeBus('Bus #005')">Remove</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Maintenance Schedule -->
                <div class="card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Upcoming Maintenance</h3>
                    <div class="space-y-3">
                        <div
                            class="flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center">
                                    <i data-feather="tool" class="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800">Bus #007 - Oil Change</h4>
                                    <p class="text-sm text-gray-600">Scheduled for January 25, 2024</p>
                                    <p class="text-xs text-gray-500">Estimated duration: 2 hours</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button class="btn-primary text-sm px-3 py-1"
                                    onclick="rescheduleMaintenace('Bus #007')">Reschedule</button>
                                <button class="btn-success text-sm px-3 py-1"
                                    onclick="completeMaintenace('Bus #007')">Complete</button>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-red-500 rounded-lg flex items-center justify-center">
                                    <i data-feather="alert-triangle" class="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800">Bus #012 - Brake Inspection</h4>
                                    <p class="text-sm text-gray-600">Overdue by 3 days</p>
                                    <p class="text-xs text-gray-500">Priority: High</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button class="btn-danger text-sm px-3 py-1"
                                    onclick="urgentMaintenace('Bus #012')">Urgent</button>
                                <button class="btn-success text-sm px-3 py-1"
                                    onclick="completeMaintenace('Bus #012')">Complete</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Students Section -->
            <div id="studentsSection" class="hidden space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-800">Student Management</h2>
                    <button class="btn-primary" onclick="openModal('addStudentModal')">
                        <i data-feather="user-plus" class="w-4 h-4 mr-2"></i>
                        Add Student
                    </button>
                </div>

                <div class="grid-3">
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Total Students</h3>
                        <p class="text-3xl font-bold text-blue-600">1,247</p>
                        <p class="text-sm text-gray-600 mt-2">Across all routes</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Present Today</h3>
                        <p class="text-3xl font-bold text-green-600">1,228</p>
                        <p class="text-sm text-gray-600 mt-2">98.5% attendance</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Absent Today</h3>
                        <p class="text-3xl font-bold text-red-600">19</p>
                        <p class="text-sm text-gray-600 mt-2">1.5% absence rate</p>
                    </div>
                </div>

                <div class="card">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Student Directory</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Student
                                        ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Grade
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Route
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stop
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="studentsTable">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">STU001</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Emma Johnson</td>
                                    <td class="px-6 py-4 whitespace-nowrap">5th</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 5A</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Stop 12</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Present</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3">Edit</button>
                                        <button class="text-red-600 hover:text-red-800">Remove</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Schedule Section -->
            <div id="scheduleSection" class="hidden space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">Today's Schedule</h2>

                <div class="grid-2">
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Morning Routes</h3>
                        <div class="space-y-3" id="morningSchedule">
                            <div class="schedule-item">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h4 class="font-semibold">Route 5A - Bus #12</h4>
                                        <p class="text-sm text-gray-600">Driver: Mike Johnson</p>
                                        <p class="text-xs text-gray-500">15 stops • 45 students</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold text-green-600">7:30 AM</p>
                                        <p class="text-xs text-gray-500">On Time</p>
                                    </div>
                                </div>
                            </div>

                            <div class="schedule-item">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h4 class="font-semibold">Route 3B - Bus #7</h4>
                                        <p class="text-sm text-gray-600">Driver: Sarah Davis</p>
                                        <p class="text-xs text-gray-500">12 stops • 38 students</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold text-yellow-600">7:45 AM</p>
                                        <p class="text-xs text-gray-500">Delayed 5 min</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Afternoon Routes</h3>
                        <div class="space-y-3" id="afternoonSchedule">
                            <div class="schedule-item">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h4 class="font-semibold">Route 8C - Bus #23</h4>
                                        <p class="text-sm text-gray-600">Driver: Robert Wilson</p>
                                        <p class="text-xs text-gray-500">18 stops • 52 students</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold text-blue-600">3:15 PM</p>
                                        <p class="text-xs text-gray-500">Scheduled</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Attendance Section -->
            <div id="attendanceSection" class="hidden space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-800">Student Attendance</h2>
                    <div class="flex space-x-3">
                        <button class="btn-success" onclick="markAllPresent()">
                            <i data-feather="check-circle" class="w-4 h-4 mr-2"></i>
                            Mark All Present
                        </button>
                        <button class="btn-primary" onclick="openModal('attendanceReportModal')">
                            <i data-feather="download" class="w-4 h-4 mr-2"></i>
                            Export Report
                        </button>
                    </div>
                </div>

                <!-- Attendance Statistics -->
                <div class="grid-4">
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Today's Attendance</p>
                                <p class="text-3xl font-bold text-green-600">98.5%</p>
                                <p class="text-sm text-green-600 mt-1">↑ 0.3% from yesterday</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                                <i data-feather="check-circle" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Present Students</p>
                                <p class="text-3xl font-bold text-blue-600">1,228</p>
                                <p class="text-sm text-gray-600 mt-1">Out of 1,247 total</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                <i data-feather="users" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Absent Students</p>
                                <p class="text-3xl font-bold text-red-600">19</p>
                                <p class="text-sm text-red-600 mt-1">Requires follow-up</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-red-500 to-red-600 rounded-xl flex items-center justify-center">
                                <i data-feather="user-x" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Late Arrivals</p>
                                <p class="text-3xl font-bold text-yellow-600">7</p>
                                <p class="text-sm text-yellow-600 mt-1">After 8:00 AM</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center">
                                <i data-feather="clock" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Attendance Actions</h3>
                    <div class="grid-4">
                        <button class="btn-primary flex flex-col items-center p-4 rounded-lg"
                            onclick="takeAttendance()">
                            <i data-feather="clipboard" class="w-8 h-8 mb-2"></i>
                            <span>Take Attendance</span>
                        </button>
                        <button class="btn-success flex flex-col items-center p-4 rounded-lg" onclick="viewAbsentees()">
                            <i data-feather="user-minus" class="w-8 h-8 mb-2"></i>
                            <span>View Absentees</span>
                        </button>
                        <button class="btn-warning flex flex-col items-center p-4 rounded-lg"
                            onclick="sendNotifications()">
                            <i data-feather="bell" class="w-8 h-8 mb-2"></i>
                            <span>Notify Parents</span>
                        </button>
                        <button class="btn-primary flex flex-col items-center p-4 rounded-lg"
                            onclick="attendanceHistory()">
                            <i data-feather="calendar" class="w-8 h-8 mb-2"></i>
                            <span>View History</span>
                        </button>
                    </div>
                </div>

                <!-- Route-wise Attendance -->
                <div class="grid-2">
                    <!-- Attendance by Route -->
                    <div class="card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">Attendance by Route</h3>
                            <select class="text-sm border border-gray-300 rounded-lg px-3 py-1"
                                onchange="filterByRoute(this.value)">
                                <option value="">All Routes</option>
                                <option value="5A">Route 5A</option>
                                <option value="3B">Route 3B</option>
                                <option value="8C">Route 8C</option>
                                <option value="2A">Route 2A</option>
                            </select>
                        </div>
                        <div class="space-y-3" id="routeAttendance">
                            <div
                                class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                                        <span class="text-white font-bold text-sm">5A</span>
                                    </div>
                                    <div>
                                        <p class="font-medium">Route 5A - Lincoln Elementary</p>
                                        <p class="text-sm text-gray-600">44/45 students present</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-green-600">97.8%</p>
                                    <p class="text-xs text-gray-500">1 absent</p>
                                </div>
                            </div>

                            <div
                                class="flex items-center justify-between p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center">
                                        <span class="text-white font-bold text-sm">3B</span>
                                    </div>
                                    <div>
                                        <p class="font-medium">Route 3B - Washington High</p>
                                        <p class="text-sm text-gray-600">35/38 students present</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-yellow-600">92.1%</p>
                                    <p class="text-xs text-gray-500">3 absent</p>
                                </div>
                            </div>

                            <div
                                class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                                        <span class="text-white font-bold text-sm">8C</span>
                                    </div>
                                    <div>
                                        <p class="font-medium">Route 8C - Roosevelt Middle</p>
                                        <p class="text-sm text-gray-600">52/52 students present</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-green-600">100%</p>
                                    <p class="text-xs text-gray-500">Perfect!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Attendance Activity -->
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                        <div class="space-y-3" id="attendanceActivity">
                            <div class="flex items-start space-x-3 p-3 bg-green-50 rounded-lg">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                    <i data-feather="check" class="w-4 h-4 text-white"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium text-green-800">Emma Johnson marked present</p>
                                    <p class="text-sm text-green-600">Route 5A • Stop 12 • 7:45 AM</p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-3 p-3 bg-red-50 rounded-lg">
                                <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center">
                                    <i data-feather="x" class="w-4 h-4 text-white"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium text-red-800">Michael Davis marked absent</p>
                                    <p class="text-sm text-red-600">Route 3B • Stop 8 • Parent notified</p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-3 p-3 bg-yellow-50 rounded-lg">
                                <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                    <i data-feather="clock" class="w-4 h-4 text-white"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium text-yellow-800">Sarah Wilson arrived late</p>
                                    <p class="text-sm text-yellow-600">Route 2A • 15 minutes late</p>
                                </div>
                            </div>

                            <div class="flex items-start space-x-3 p-3 bg-blue-50 rounded-lg">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                    <i data-feather="info" class="w-4 h-4 text-white"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium text-blue-800">Attendance report generated</p>
                                    <p class="text-sm text-blue-600">Daily report sent to administration</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attendance Chart -->
                <div class="card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Attendance Trends</h3>
                        <div class="flex space-x-2">
                            <select class="text-sm border border-gray-300 rounded-lg px-3 py-1"
                                onchange="updateAttendanceChart(this.value)">
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="year">This Year</option>
                            </select>
                            <button class="btn-primary text-sm px-3 py-1" onclick="refreshAttendanceData()">
                                <i data-feather="refresh-cw" class="w-4 h-4 mr-1"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div style="height: 400px; position: relative;">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                </div>

                <!-- Student Attendance Table -->
                <div class="card">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold">Today's Attendance Details</h3>
                            <div class="flex items-center space-x-3">
                                <input type="text" placeholder="Search students..."
                                    class="px-3 py-2 border border-gray-300 rounded-lg text-sm" id="attendanceSearch">
                                <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                    id="attendanceFilter" onchange="filterAttendance(this.value)">
                                    <option value="">All Students</option>
                                    <option value="present">Present</option>
                                    <option value="absent">Absent</option>
                                    <option value="late">Late</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Student
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Grade
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Route
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stop
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Check-in
                                        Time</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="attendanceTable">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div
                                                class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-medium text-sm">EJ</span>
                                            </div>
                                            <div class="ml-3">
                                                <p class="font-medium">Emma Johnson</p>
                                                <p class="text-sm text-gray-500">STU001</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">5th</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 5A</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Stop 12</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">7:45 AM</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Present</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="viewStudentAttendance('STU001')">History</button>
                                        <button class="text-green-600 hover:text-green-800"
                                            onclick="contactParent('STU001')">Contact</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div
                                                class="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-medium text-sm">MD</span>
                                            </div>
                                            <div class="ml-3">
                                                <p class="font-medium">Michael Davis</p>
                                                <p class="text-sm text-gray-500">STU002</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">4th</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 3B</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Stop 8</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">Absent</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="viewStudentAttendance('STU002')">History</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="markPresent('STU002')">Mark Present</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div
                                                class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-medium text-sm">SW</span>
                                            </div>
                                            <div class="ml-3">
                                                <p class="font-medium">Sarah Wilson</p>
                                                <p class="text-sm text-gray-500">STU003</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">6th</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 2A</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Stop 5</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">8:15 AM</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">Late</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="viewStudentAttendance('STU003')">History</button>
                                        <button class="text-green-600 hover:text-green-800"
                                            onclick="contactParent('STU003')">Contact</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Route Planning Section -->
            <div id="routesSection" class="hidden space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-800">Route Planning</h2>
                    <button class="btn-primary" onclick="openModal('addRouteModal')">
                        <i data-feather="plus" class="w-4 h-4 mr-2"></i>
                        Create New Route
                    </button>
                </div>

                <!-- Route Statistics -->
                <div class="grid-4">
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Active Routes</p>
                                <p class="text-3xl font-bold text-blue-600">18</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                <i data-feather="map" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Total Stops</p>
                                <p class="text-3xl font-bold text-green-600">247</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                                <i data-feather="map-pin" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Avg Route Time</p>
                                <p class="text-3xl font-bold text-yellow-600">45m</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center">
                                <i data-feather="clock" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Efficiency</p>
                                <p class="text-3xl font-bold text-purple-600">92%</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
                                <i data-feather="trending-up" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Routes Table -->
                <div class="card">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Route Overview</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Route ID
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stops
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Students
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Duration
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">Route 5A</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Lincoln Elementary</td>
                                    <td class="px-6 py-4 whitespace-nowrap">15</td>
                                    <td class="px-6 py-4 whitespace-nowrap">45</td>
                                    <td class="px-6 py-4 whitespace-nowrap">42 min</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editRoute('Route 5A')">Edit</button>
                                        <button class="text-green-600 hover:text-green-800 mr-3"
                                            onclick="viewRoute('Route 5A')">View</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="deleteRoute('Route 5A')">Delete</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">Route 3B</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Washington High</td>
                                    <td class="px-6 py-4 whitespace-nowrap">12</td>
                                    <td class="px-6 py-4 whitespace-nowrap">38</td>
                                    <td class="px-6 py-4 whitespace-nowrap">35 min</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editRoute('Route 3B')">Edit</button>
                                        <button class="text-green-600 hover:text-green-800 mr-3"
                                            onclick="viewRoute('Route 3B')">View</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="deleteRoute('Route 3B')">Delete</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Driver Management Section -->
            <div id="driversSection" class="hidden space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-800">Driver Management</h2>
                    <button class="btn-primary" onclick="openModal('addDriverModal')">
                        <i data-feather="user-plus" class="w-4 h-4 mr-2"></i>
                        Add Driver
                    </button>
                </div>

                <!-- Driver Statistics -->
                <div class="grid-4">
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Total Drivers</p>
                                <p class="text-3xl font-bold text-blue-600">32</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                <i data-feather="users" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">On Duty</p>
                                <p class="text-3xl font-bold text-green-600">24</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                                <i data-feather="check-circle" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Off Duty</p>
                                <p class="text-3xl font-bold text-yellow-600">6</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center">
                                <i data-feather="clock" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">On Leave</p>
                                <p class="text-3xl font-bold text-red-600">2</p>
                            </div>
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-red-500 to-red-600 rounded-xl flex items-center justify-center">
                                <i data-feather="user-x" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Drivers Table -->
                <div class="card">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Driver Directory</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Driver
                                        ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">License
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Route
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        Experience</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">DRV001</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Mike Johnson</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">CDL-123456</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 5A</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">8 years</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">On
                                            Duty</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editDriver('DRV001')">Edit</button>
                                        <button class="text-green-600 hover:text-green-800 mr-3"
                                            onclick="viewDriver('DRV001')">View</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="removeDriver('DRV001')">Remove</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">DRV002</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Sarah Davis</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">CDL-789012</td>
                                    <td class="px-6 py-4 whitespace-nowrap">Route 3B</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">5 years</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">On
                                            Duty</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button class="text-blue-600 hover:text-blue-800 mr-3"
                                            onclick="editDriver('DRV002')">Edit</button>
                                        <button class="text-green-600 hover:text-green-800 mr-3"
                                            onclick="viewDriver('DRV002')">View</button>
                                        <button class="text-red-600 hover:text-red-800"
                                            onclick="removeDriver('DRV002')">Remove</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Parent Portal Section -->
            <div id="parentsSection" class="hidden space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">Parent Portal</h2>

                <div class="grid-3">
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Active Parents</h3>
                        <p class="text-3xl font-bold text-blue-600">892</p>
                        <p class="text-sm text-gray-600 mt-2">Registered accounts</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Notifications Sent</h3>
                        <p class="text-3xl font-bold text-green-600">1,247</p>
                        <p class="text-sm text-gray-600 mt-2">This week</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">App Downloads</h3>
                        <p class="text-3xl font-bold text-purple-600">756</p>
                        <p class="text-sm text-gray-600 mt-2">Mobile app users</p>
                    </div>
                </div>

                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">Recent Parent Communications</h3>
                    <div class="space-y-3">
                        <div class="p-3 bg-blue-50 border-l-4 border-blue-500">
                            <p class="font-medium">Route 5A Delay Notification</p>
                            <p class="text-sm text-gray-600">Sent to 45 parents - 15 minutes ago</p>
                        </div>
                        <div class="p-3 bg-green-50 border-l-4 border-green-500">
                            <p class="font-medium">Weekly Schedule Update</p>
                            <p class="text-sm text-gray-600">Sent to all parents - 2 hours ago</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="hidden space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">Analytics & Reports</h2>

                <div class="grid-4">
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">On-Time Rate</h3>
                        <p class="text-3xl font-bold text-green-600">94.2%</p>
                        <p class="text-sm text-green-600 mt-2">↑ 2.1% from last month</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Fuel Efficiency</h3>
                        <p class="text-3xl font-bold text-blue-600">8.2 MPG</p>
                        <p class="text-sm text-red-600 mt-2">↓ 0.3 from last month</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Student Satisfaction</h3>
                        <p class="text-3xl font-bold text-purple-600">4.7/5</p>
                        <p class="text-sm text-green-600 mt-2">↑ 0.2 from last survey</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Cost per Mile</h3>
                        <p class="text-3xl font-bold text-yellow-600">$2.45</p>
                        <p class="text-sm text-green-600 mt-2">↓ $0.15 from last month</p>
                    </div>
                </div>

                <div class="card p-6">
                    <h3 class="text-lg font-semibold mb-4">Performance Trends</h3>
                    <div style="height: 300px; position: relative;">
                        <canvas id="analyticsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsSection" class="hidden space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">System Reports</h2>

                <div class="grid-2">
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">📊 Fleet Reports</h3>
                        <div class="space-y-3">
                            <button class="w-full text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100"
                                onclick="generateReport('fleet-utilization')">
                                Fleet Utilization Report
                            </button>
                            <button class="w-full text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100"
                                onclick="generateReport('maintenance-summary')">
                                Maintenance Summary
                            </button>
                            <button class="w-full text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100"
                                onclick="generateReport('fuel-consumption')">
                                Fuel Consumption Report
                            </button>
                        </div>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">👥 Student Reports</h3>
                        <div class="space-y-3">
                            <button class="w-full text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100"
                                onclick="generateReport('attendance-report')">
                                Attendance Report
                            </button>
                            <button class="w-full text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100"
                                onclick="generateReport('route-efficiency')">
                                Route Efficiency Report
                            </button>
                            <button class="w-full text-left p-3 bg-gray-50 rounded-lg hover:bg-gray-100"
                                onclick="generateReport('safety-incidents')">
                                Safety Incidents Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="hidden space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">System Settings</h2>

                <div class="grid-2">
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">🔧 General Settings</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span>Auto Notifications</span>
                                <input type="checkbox" checked class="toggle">
                            </div>
                            <div class="flex items-center justify-between">
                                <span>GPS Tracking</span>
                                <input type="checkbox" checked class="toggle">
                            </div>
                            <div class="flex items-center justify-between">
                                <span>Emergency Alerts</span>
                                <input type="checkbox" checked class="toggle">
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">👤 User Management</h3>
                        <div class="space-y-3">
                            <button class="btn-primary w-full" onclick="manageUsers()">Manage Users</button>
                            <button class="btn-secondary w-full bg-gray-300 text-gray-700" onclick="backupData()">Backup
                                Data</button>
                            <button class="btn-warning w-full" onclick="systemMaintenance()">System Maintenance</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Emergency Button -->
    <div class="emergency-button" onclick="triggerEmergency()" title="Emergency Alert">
        <i data-feather="alert-triangle"></i>
    </div>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notificationPanel">
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold">Notifications</h3>
                <button onclick="closeNotifications()" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
        <div class="p-4 space-y-4" id="notificationsList">
            <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                <div class="flex items-start space-x-3">
                    <i data-feather="alert-triangle" class="w-5 h-5 text-red-500 mt-0.5"></i>
                    <div>
                        <p class="font-medium text-red-800">Bus #12 Engine Warning</p>
                        <p class="text-sm text-red-600">Immediate attention required</p>
                        <p class="text-xs text-red-500 mt-1">2 minutes ago</p>
                    </div>
                </div>
            </div>

            <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-start space-x-3">
                    <i data-feather="clock" class="w-5 h-5 text-yellow-500 mt-0.5"></i>
                    <div>
                        <p class="font-medium text-yellow-800">Route 3B Delayed</p>
                        <p class="text-sm text-yellow-600">15 minutes behind schedule</p>
                        <p class="text-xs text-yellow-500 mt-1">8 minutes ago</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Bus Modal -->
    <div class="modal" id="addBusModal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Add New Bus</h3>
                <button onclick="closeModal('addBusModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form onsubmit="addBus(event)">
                <div class="form-group">
                    <label class="form-label">Bus Number</label>
                    <input type="text" class="form-input" placeholder="e.g., Bus #025" required>
                </div>
                <div class="form-group">
                    <label class="form-label">License Plate</label>
                    <input type="text" class="form-input" placeholder="e.g., ABC-1234" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Capacity</label>
                    <input type="number" class="form-input" placeholder="e.g., 72" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Year</label>
                    <input type="number" class="form-input" placeholder="e.g., 2020" required>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary flex-1">Add Bus</button>
                    <button type="button" onclick="closeModal('addBusModal')"
                        class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div class="modal" id="addStudentModal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Add New Student</h3>
                <button onclick="closeModal('addStudentModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form onsubmit="addStudent(event)">
                <div class="form-group">
                    <label class="form-label">Student Name</label>
                    <input type="text" class="form-input" placeholder="e.g., John Smith" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Grade</label>
                    <select class="form-input" required>
                        <option value="">Select Grade</option>
                        <option value="K">Kindergarten</option>
                        <option value="1">1st Grade</option>
                        <option value="2">2nd Grade</option>
                        <option value="3">3rd Grade</option>
                        <option value="4">4th Grade</option>
                        <option value="5">5th Grade</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Parent/Guardian Name</label>
                    <input type="text" class="form-input" placeholder="e.g., Jane Smith" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" placeholder="e.g., (555) 123-4567" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Address</label>
                    <textarea class="form-input" rows="3" placeholder="Student's home address" required></textarea>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary flex-1">Add Student</button>
                    <button type="button" onclick="closeModal('addStudentModal')"
                        class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Driver Modal -->
    <div class="modal" id="addDriverModal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Add New Driver</h3>
                <button onclick="closeModal('addDriverModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form onsubmit="addDriver(event)">
                <div class="form-group">
                    <label class="form-label">Driver Name</label>
                    <input type="text" class="form-input" placeholder="e.g., Mike Johnson" required>
                </div>
                <div class="form-group">
                    <label class="form-label">License Number</label>
                    <input type="text" class="form-input" placeholder="e.g., D123456789" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" placeholder="e.g., (555) 987-6543" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Experience (Years)</label>
                    <input type="number" class="form-input" placeholder="e.g., 5" required>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary flex-1">Add Driver</button>
                    <button type="button" onclick="closeModal('addDriverModal')"
                        class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Route Modal -->
    <div class="modal" id="addRouteModal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Create New Route</h3>
                <button onclick="closeModal('addRouteModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form onsubmit="addRoute(event)">
                <div class="form-group">
                    <label class="form-label">Route Name</label>
                    <input type="text" class="form-input" placeholder="e.g., Lincoln Elementary Route" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Route ID</label>
                    <input type="text" class="form-input" placeholder="e.g., Route 6A" required>
                </div>
                <div class="form-group">
                    <label class="form-label">School</label>
                    <select class="form-input" required>
                        <option value="">Select School</option>
                        <option value="lincoln">Lincoln Elementary</option>
                        <option value="washington">Washington High</option>
                        <option value="roosevelt">Roosevelt Middle</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Estimated Duration (minutes)</label>
                    <input type="number" class="form-input" placeholder="e.g., 45" required>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary flex-1">Create Route</button>
                    <button type="button" onclick="closeModal('addRouteModal')"
                        class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Maintenance Schedule Modal -->
    <div class="modal" id="maintenanceScheduleModal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Schedule Maintenance</h3>
                <button onclick="closeModal('maintenanceScheduleModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form onsubmit="scheduleMaintenance(event)">
                <div class="form-group">
                    <label class="form-label">Bus</label>
                    <select class="form-input" required>
                        <option value="">Select Bus</option>
                        <option value="bus001">Bus #001</option>
                        <option value="bus002">Bus #002</option>
                        <option value="bus003">Bus #003</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Maintenance Type</label>
                    <select class="form-input" required>
                        <option value="">Select Type</option>
                        <option value="oil-change">Oil Change</option>
                        <option value="brake-service">Brake Service</option>
                        <option value="tire-rotation">Tire Rotation</option>
                        <option value="engine-check">Engine Check</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Scheduled Date</label>
                    <input type="date" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select class="form-input" required>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary flex-1">Schedule</button>
                    <button type="button" onclick="closeModal('maintenanceScheduleModal')"
                        class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Maintenance Modal -->
    <div class="modal" id="maintenanceModal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Quick Maintenance</h3>
                <button onclick="closeModal('maintenanceModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="space-y-4">
                <button
                    class="w-full p-4 text-left bg-yellow-50 border border-yellow-200 rounded-lg hover:bg-yellow-100"
                    onclick="quickMaintenance('inspection')">
                    <div class="flex items-center space-x-3">
                        <i data-feather="search" class="w-6 h-6 text-yellow-600"></i>
                        <div>
                            <p class="font-medium">Schedule Inspection</p>
                            <p class="text-sm text-gray-600">Routine safety inspection</p>
                        </div>
                    </div>
                </button>
                <button class="w-full p-4 text-left bg-red-50 border border-red-200 rounded-lg hover:bg-red-100"
                    onclick="quickMaintenance('urgent')">
                    <div class="flex items-center space-x-3">
                        <i data-feather="alert-triangle" class="w-6 h-6 text-red-600"></i>
                        <div>
                            <p class="font-medium">Urgent Repair</p>
                            <p class="text-sm text-gray-600">Immediate attention required</p>
                        </div>
                    </div>
                </button>
                <button class="w-full p-4 text-left bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100"
                    onclick="quickMaintenance('scheduled')">
                    <div class="flex items-center space-x-3">
                        <i data-feather="calendar" class="w-6 h-6 text-blue-600"></i>
                        <div>
                            <p class="font-medium">Scheduled Service</p>
                            <p class="text-sm text-gray-600">Regular maintenance schedule</p>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Attendance Report Modal -->
    <div class="modal" id="attendanceReportModal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Export Attendance Report</h3>
                <button onclick="closeModal('attendanceReportModal')" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form onsubmit="exportAttendanceReport(event)">
                <div class="form-group">
                    <label class="form-label">Report Type</label>
                    <select class="form-input" required>
                        <option value="">Select Report Type</option>
                        <option value="daily">Daily Report</option>
                        <option value="weekly">Weekly Summary</option>
                        <option value="monthly">Monthly Report</option>
                        <option value="custom">Custom Date Range</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Date Range</label>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="date" class="form-input" placeholder="From Date" required>
                        <input type="date" class="form-input" placeholder="To Date" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Include</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2" checked>
                            <span class="text-sm">Present Students</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2" checked>
                            <span class="text-sm">Absent Students</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2">
                            <span class="text-sm">Late Arrivals</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2">
                            <span class="text-sm">Route Information</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Export Format</label>
                    <select class="form-input" required>
                        <option value="pdf">PDF Report</option>
                        <option value="excel">Excel Spreadsheet</option>
                        <option value="csv">CSV File</option>
                    </select>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary flex-1">Export Report</button>
                    <button type="button" onclick="closeModal('attendanceReportModal')"
                        class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize Feather Icons
        feather.replace();

        // Global Variables
        let currentSection = 'dashboard';
        let notifications = [];
        let students = [];
        let drivers = [];
        let buses = [];

        // Sidebar Functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }

        // Section Navigation
        function showSection(sectionName) {
            // Hide all sections
            const sections = ['dashboard', 'fleet', 'routes', 'students', 'drivers', 'parents', 'schedule', 'attendance', 'analytics', 'reports', 'settings'];
            sections.forEach(section => {
                const element = document.getElementById(section + 'Section');
                if (element) {
                    element.classList.add('hidden');
                }
            });

            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            // Update navigation active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Find the clicked nav item and make it active
            const clickedNavItem = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
            if (clickedNavItem) {
                clickedNavItem.classList.add('active');
            }

            // Update page title
            const titles = {
                dashboard: 'Dashboard Overview',
                fleet: 'Fleet Management',
                routes: 'Route Planning',
                students: 'Student Management',
                drivers: 'Driver Management',
                parents: 'Parent Portal',
                schedule: 'Today\'s Schedule',
                attendance: 'Student Attendance',
                analytics: 'Analytics & Reports',
                reports: 'System Reports',
                settings: 'System Settings'
            };

            document.getElementById('pageTitle').textContent = titles[sectionName] || 'STMS Dashboard';
            currentSection = sectionName;

            // Close sidebar on mobile
            closeSidebar();
        }

        // Fleet Management Functions


        // Fleet Management Functions
        function performFleetAction(action) {
            switch (action) {
                case 'inspection':
                    showFleetInspectionModal();
                    break;
                case 'fuel':
                    showFuelReportModal();
                    break;
                case 'maintenance':
                    showMaintenanceLogModal();
                    break;
                case 'gps':
                    showGPSTrackingModal();
                    break;
            }
        }

        function showFleetInspectionModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">🔍 Fleet Inspection Report</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-green-50 rounded-lg">
                                <p class="text-sm text-gray-600">Passed Inspection</p>
                                <p class="text-2xl font-bold text-green-600">22</p>
                            </div>
                            <div class="p-3 bg-red-50 rounded-lg">
                                <p class="text-sm text-gray-600">Failed Inspection</p>
                                <p class="text-2xl font-bold text-red-600">2</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="p-3 bg-red-50 border-l-4 border-red-500">
                                <p class="font-medium">Bus #003 - Brake Issues</p>
                                <p class="text-sm text-gray-600">Requires immediate attention</p>
                            </div>
                            <div class="p-3 bg-red-50 border-l-4 border-red-500">
                                <p class="font-medium">Bus #018 - Tire Replacement</p>
                                <p class="text-sm text-gray-600">Schedule within 48 hours</p>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove(); addNotification('success', 'Inspection Complete', 'Fleet inspection report generated successfully.');" class="btn-primary w-full">Generate Full Report</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function showFuelReportModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">⛽ Fuel Efficiency Report</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="p-3 bg-blue-50 rounded-lg text-center">
                                <p class="text-sm text-gray-600">Average MPG</p>
                                <p class="text-xl font-bold text-blue-600">8.2</p>
                            </div>
                            <div class="p-3 bg-green-50 rounded-lg text-center">
                                <p class="text-sm text-gray-600">Best Performer</p>
                                <p class="text-xl font-bold text-green-600">9.1</p>
                            </div>
                            <div class="p-3 bg-red-50 rounded-lg text-center">
                                <p class="text-sm text-gray-600">Needs Attention</p>
                                <p class="text-xl font-bold text-red-600">6.8</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <p class="font-medium">Top Performers:</p>
                            <div class="text-sm space-y-1">
                                <div class="flex justify-between">
                                    <span>Bus #012</span>
                                    <span class="text-green-600">9.1 MPG</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Bus #007</span>
                                    <span class="text-green-600">8.9 MPG</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove(); addNotification('info', 'Report Downloaded', 'Fuel efficiency report downloaded successfully.');" class="btn-primary w-full">Download Report</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function showMaintenanceLogModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">🔧 Maintenance Log</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="space-y-3">
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Bus #001 - Oil Change</p>
                                        <p class="text-sm text-gray-600">Completed: Jan 15, 2024</p>
                                    </div>
                                    <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">Complete</span>
                                </div>
                            </div>
                            <div class="p-3 bg-yellow-50 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Bus #007 - Brake Service</p>
                                        <p class="text-sm text-gray-600">Scheduled: Jan 25, 2024</p>
                                    </div>
                                    <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">Pending</span>
                                </div>
                            </div>
                            <div class="p-3 bg-red-50 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Bus #012 - Engine Check</p>
                                        <p class="text-sm text-gray-600">Overdue: 3 days</p>
                                    </div>
                                    <span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded">Overdue</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="openModal('maintenanceScheduleModal'); this.closest('.modal').remove();" class="btn-primary flex-1">Schedule New</button>
                            <button onclick="this.closest('.modal').remove();" class="btn-secondary flex-1 bg-gray-300 text-gray-700">Close</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function showGPSTrackingModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">📍 GPS Tracking Status</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-green-50 rounded-lg text-center">
                                <p class="text-sm text-gray-600">Online Buses</p>
                                <p class="text-2xl font-bold text-green-600">24</p>
                            </div>
                            <div class="p-3 bg-red-50 rounded-lg text-center">
                                <p class="text-sm text-gray-600">Offline Buses</p>
                                <p class="text-2xl font-bold text-red-600">4</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <p class="font-medium">Active Routes:</p>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                    <span>Bus #012 - Route 5A</span>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                        <span class="text-sm">Online</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                    <span>Bus #007 - Route 3B</span>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                        <span class="text-sm">Online</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove(); addNotification('info', 'GPS Activated', 'Real-time GPS tracking enabled for all buses.');" class="btn-primary w-full">Enable Live Tracking</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function editBus(busId) {
            alert(`🚌 Editing ${busId}\n\n✏️ Bus Information Editor\n📝 License Plate: ABC-1234\n👨‍✈️ Assigned Driver: Mike Johnson\n🛣️ Current Route: Route 5A\n⛽ Fuel Level: 78%\n🔧 Last Maintenance: 2024-01-15\n\n[Edit functionality would open detailed form]`);
        }

        function trackBus(busId) {
            alert(`📍 Tracking ${busId}\n\n🗺️ Current Location: Main St & 5th Ave\n⏰ Last Update: 2 minutes ago\n🚦 Status: Moving\n👥 Passengers: 45/72\n📊 Speed: 25 mph\n🛣️ Next Stop: Lincoln Elementary\n⏱️ ETA: 8 minutes\n\n[Real-time tracking would show on map]`);
        }

        function removeBus(busId) {
            if (confirm(`⚠️ Remove ${busId} from Fleet?\n\nThis action will:\n• Remove bus from active fleet\n• Unassign current driver\n• Cancel scheduled routes\n• Archive maintenance records\n\nAre you sure you want to proceed?`)) {
                addNotification('warning', 'Bus Removed', `${busId} has been removed from the active fleet.`);
                // Remove from table
                const row = event.target.closest('tr');
                row.style.opacity = '0.5';
                setTimeout(() => row.remove(), 1000);
            }
        }

        function rescheduleMaintenace(busId) {
            const newDate = prompt(`📅 Reschedule Maintenance for ${busId}\n\nCurrent Date: January 25, 2024\nEnter new date (YYYY-MM-DD):`);
            if (newDate) {
                addNotification('success', 'Maintenance Rescheduled', `${busId} maintenance rescheduled to ${newDate}.`);
            }
        }

        function completeMaintenace(busId) {
            if (confirm(`✅ Mark maintenance as complete for ${busId}?`)) {
                addNotification('success', 'Maintenance Complete', `${busId} maintenance has been marked as completed.`);
                event.target.closest('.p-4').style.opacity = '0.5';
                setTimeout(() => event.target.closest('.p-4').remove(), 1000);
            }
        }

        function urgentMaintenace(busId) {
            if (confirm(`🚨 Mark ${busId} for URGENT maintenance?\n\nThis will:\n• Remove bus from active service\n• Notify maintenance team immediately\n• Alert route coordinator\n• Send parent notifications\n\nProceed?`)) {
                addNotification('error', 'Urgent Maintenance', `${busId} marked for urgent maintenance. Bus removed from service.`);
            }
        }

        // Modal Functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Notification Functions
        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('active');
        }

        function closeNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.remove('active');
        }

        function addNotification(type, title, message) {
            const notification = {
                id: Date.now(),
                type: type,
                title: title,
                message: message,
                timestamp: new Date()
            };

            notifications.unshift(notification);
            updateNotificationsList();
            updateNotificationBadge();
        }

        function updateNotificationsList() {
            const list = document.getElementById('notificationsList');
            if (!list) return;

            list.innerHTML = notifications.map(notif => `
                <div class="p-3 bg-${getNotificationColor(notif.type)}-50 border border-${getNotificationColor(notif.type)}-200 rounded-lg">
                    <div class="flex items-start space-x-3">
                        <i data-feather="${getNotificationIcon(notif.type)}" class="w-5 h-5 text-${getNotificationColor(notif.type)}-500 mt-0.5"></i>
                        <div>
                            <p class="font-medium text-${getNotificationColor(notif.type)}-800">${notif.title}</p>
                            <p class="text-sm text-${getNotificationColor(notif.type)}-600">${notif.message}</p>
                            <p class="text-xs text-${getNotificationColor(notif.type)}-500 mt-1">${formatTime(notif.timestamp)}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            feather.replace();
        }

        function updateNotificationBadge() {
            const badges = document.querySelectorAll('.notification-badge');
            badges.forEach(badge => {
                if (badge.parentElement.querySelector('[data-feather="bell"]')) {
                    badge.textContent = notifications.length;
                }
            });
        }

        function getNotificationColor(type) {
            const colors = {
                'error': 'red',
                'warning': 'yellow',
                'info': 'blue',
                'success': 'green'
            };
            return colors[type] || 'blue';
        }

        function getNotificationIcon(type) {
            const icons = {
                'error': 'alert-triangle',
                'warning': 'clock',
                'info': 'info',
                'success': 'check-circle'
            };
            return icons[type] || 'info';
        }

        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes} minutes ago`;
            if (minutes < 1440) return `${Math.floor(minutes / 60)} hours ago`;
            return date.toLocaleDateString();
        }

        // Emergency Functions
        function triggerEmergency() {
            if (confirm('⚠️ EMERGENCY ALERT ⚠️\n\nThis will send an emergency notification to all drivers, parents, and school officials.\n\nAre you sure you want to proceed?')) {
                // Simulate emergency protocol
                addNotification('error', 'EMERGENCY ACTIVATED', 'Emergency protocol has been initiated. All units have been notified.');

                // Show emergency modal
                alert('🚨 EMERGENCY PROTOCOL ACTIVATED 🚨\n\n✅ All drivers notified\n✅ Parents alerted via SMS\n✅ School officials contacted\n✅ Emergency services on standby\n\nEmergency ID: EMG-' + Date.now());

                // Update UI to show emergency state
                document.body.style.background = 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
                setTimeout(() => {
                    document.body.style.background = '';
                }, 5000);
            }
        }

        // Bus Info Functions
        function showBusInfo(busId, route, status) {
            alert(`🚌 ${busId}\n\n📍 Route: ${route}\n⏰ Status: ${status}\n👨‍✈️ Driver: Available\n📊 Capacity: 45/72 students\n⛽ Fuel: 78%\n🔧 Last Maintenance: 2024-01-15`);
        }

        // Form Submission Functions
        function addBus(event) {
            event.preventDefault();
            const formData = new FormData(event.target);

            // Simulate adding bus
            addNotification('success', 'Bus Added', 'New bus has been successfully added to the fleet.');
            closeModal('addBusModal');
            event.target.reset();

            // Update metrics
            const activeBusesElement = document.getElementById('activeBuses');
            if (activeBusesElement) {
                const current = parseInt(activeBusesElement.textContent);
                activeBusesElement.textContent = current + 1;
            }
        }

        function addStudent(event) {
            event.preventDefault();
            const formData = new FormData(event.target);

            // Simulate adding student
            addNotification('success', 'Student Added', 'New student has been successfully enrolled.');
            closeModal('addStudentModal');
            event.target.reset();

            // Update metrics
            const studentsCountElement = document.getElementById('studentsCount');
            if (studentsCountElement) {
                const current = parseInt(studentsCountElement.textContent.replace(',', ''));
                studentsCountElement.textContent = (current + 1).toLocaleString();
            }
        }

        function addDriver(event) {
            event.preventDefault();
            const formData = new FormData(event.target);

            // Simulate adding driver
            addNotification('success', 'Driver Added', 'New driver has been successfully registered.');
            closeModal('addDriverModal');
            event.target.reset();
        }

        function addRoute(event) {
            event.preventDefault();
            const formData = new FormData(event.target);

            addNotification('success', 'Route Created', 'New route has been successfully created.');
            closeModal('addRouteModal');
            event.target.reset();
        }

        function scheduleMaintenance(event) {
            event.preventDefault();
            const formData = new FormData(event.target);

            addNotification('success', 'Maintenance Scheduled', 'Maintenance has been scheduled successfully.');
            closeModal('maintenanceScheduleModal');
            event.target.reset();
        }

        function quickMaintenance(type) {
            const messages = {
                'inspection': 'Safety inspection scheduled for next available slot.',
                'urgent': 'Urgent repair request submitted to maintenance team.',
                'scheduled': 'Regular maintenance added to schedule.'
            };

            addNotification('info', 'Maintenance Request', messages[type]);
            closeModal('maintenanceModal');
        }

        // Route Management Functions
        function editRoute(routeId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Edit ${routeId}</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="form-label">Route Name</label>
                            <input type="text" class="form-input" value="Lincoln Elementary" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Number of Stops</label>
                            <input type="number" class="form-input" value="15" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration (minutes)</label>
                            <input type="number" class="form-input" value="42" required>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="this.closest('.modal').remove(); addNotification('success', 'Route Updated', '${routeId} has been updated successfully.');" class="btn-primary flex-1">Save Changes</button>
                            <button onclick="this.closest('.modal').remove();" class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function viewRoute(routeId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">${routeId} Details</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-gray-50 rounded">
                                <p class="text-sm text-gray-600">Total Stops</p>
                                <p class="text-xl font-bold">15</p>
                            </div>
                            <div class="p-3 bg-gray-50 rounded">
                                <p class="text-sm text-gray-600">Students</p>
                                <p class="text-xl font-bold">45</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <p class="font-medium">Recent Stops:</p>
                            <div class="space-y-1 text-sm">
                                <div class="flex justify-between">
                                    <span>Stop 1: Main St & 1st Ave</span>
                                    <span class="text-green-600">✓ Completed</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Stop 2: Oak St & 2nd Ave</span>
                                    <span class="text-green-600">✓ Completed</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Stop 3: Pine St & 3rd Ave</span>
                                    <span class="text-blue-600">→ Current</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove();" class="btn-primary w-full">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function deleteRoute(routeId) {
            if (confirm(`⚠️ Delete ${routeId}?\n\nThis will:\n• Remove the route permanently\n• Unassign students from this route\n• Cancel scheduled trips\n\nAre you sure?`)) {
                addNotification('warning', 'Route Deleted', `${routeId} has been removed from the system.`);
                event.target.closest('tr').remove();
            }
        }

        // Driver Management Functions
        function editDriver(driverId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Edit Driver ${driverId}</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="form-label">Driver Name</label>
                            <input type="text" class="form-input" value="Mike Johnson" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">License Number</label>
                            <input type="text" class="form-input" value="CDL-123456" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-input" value="(555) 123-4567" required>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="this.closest('.modal').remove(); addNotification('success', 'Driver Updated', 'Driver information updated successfully.');" class="btn-primary flex-1">Save Changes</button>
                            <button onclick="this.closest('.modal').remove();" class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function viewDriver(driverId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Driver ${driverId} Profile</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-gray-50 rounded">
                                <p class="text-sm text-gray-600">Experience</p>
                                <p class="text-xl font-bold">8 years</p>
                            </div>
                            <div class="p-3 bg-green-50 rounded">
                                <p class="text-sm text-gray-600">Safety Rating</p>
                                <p class="text-xl font-bold text-green-600">A+</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <p class="font-medium">Recent Performance:</p>
                            <div class="space-y-1 text-sm">
                                <div class="flex justify-between">
                                    <span>On-Time Rate</span>
                                    <span class="text-green-600">98.5%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Safety Score</span>
                                    <span class="text-green-600">100%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Student Feedback</span>
                                    <span class="text-green-600">4.9/5</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove();" class="btn-primary w-full">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function removeDriver(driverId) {
            if (confirm(`⚠️ Remove Driver ${driverId}?\n\nThis will:\n• Remove driver from system\n• Unassign from current route\n• Archive employment records\n\nAre you sure?`)) {
                addNotification('warning', 'Driver Removed', `Driver ${driverId} has been removed from the system.`);
                event.target.closest('tr').remove();
            }
        }

        // Report Generation Functions
        function generateReport(reportType) {
            const reports = {
                'fleet-utilization': 'Fleet Utilization Report generated successfully.',
                'maintenance-summary': 'Maintenance Summary Report downloaded.',
                'fuel-consumption': 'Fuel Consumption Report ready for download.',
                'attendance-report': 'Student Attendance Report generated.',
                'route-efficiency': 'Route Efficiency Analysis completed.',
                'safety-incidents': 'Safety Incidents Report downloaded.'
            };

            addNotification('success', 'Report Generated', reports[reportType]);
        }

        // Settings Functions
        function manageUsers() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">User Management</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="p-3 bg-blue-50 rounded text-center">
                                <p class="text-sm text-gray-600">Total Users</p>
                                <p class="text-xl font-bold text-blue-600">45</p>
                            </div>
                            <div class="p-3 bg-green-50 rounded text-center">
                                <p class="text-sm text-gray-600">Active</p>
                                <p class="text-xl font-bold text-green-600">42</p>
                            </div>
                            <div class="p-3 bg-red-50 rounded text-center">
                                <p class="text-sm text-gray-600">Inactive</p>
                                <p class="text-xl font-bold text-red-600">3</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <button class="w-full p-3 text-left bg-gray-50 rounded hover:bg-gray-100">Add New User</button>
                            <button class="w-full p-3 text-left bg-gray-50 rounded hover:bg-gray-100">Manage Permissions</button>
                            <button class="w-full p-3 text-left bg-gray-50 rounded hover:bg-gray-100">Reset Passwords</button>
                        </div>
                        <button onclick="this.closest('.modal').remove();" class="btn-primary w-full">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function backupData() {
            if (confirm('🔄 Create System Backup?\n\nThis will create a complete backup of all system data including:\n• Fleet information\n• Student records\n• Route data\n• User accounts\n\nProceed with backup?')) {
                addNotification('info', 'Backup Started', 'System backup is in progress. You will be notified when complete.');

                // Simulate backup progress
                setTimeout(() => {
                    addNotification('success', 'Backup Complete', 'System backup completed successfully and saved to secure storage.');
                }, 3000);
            }
        }

        function systemMaintenance() {
            if (confirm('⚠️ Enter Maintenance Mode?\n\nThis will:\n• Put system in maintenance mode\n• Temporarily disable user access\n• Allow system updates and repairs\n• Send notifications to all users\n\nProceed?')) {
                addNotification('warning', 'Maintenance Mode', 'System entering maintenance mode. All users will be notified.');
            }
        }

        // Alert Functions
        function resolveAlert(button) {
            const alertElement = button.closest('.alert');
            alertElement.style.opacity = '0.5';
            button.textContent = 'Resolved';
            button.disabled = true;

            setTimeout(() => {
                alertElement.remove();
            }, 1000);
        }

        // Chart Initialization
        function initializeCharts() {
            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart');
            if (performanceCtx) {
                new Chart(performanceCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'On-Time Performance (%)',
                            data: [92, 94, 91, 96, 93, 95, 94],
                            borderColor: 'var(--primary-color)',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: 'var(--primary-color)',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Fuel Efficiency (MPG)',
                            data: [8.1, 8.3, 7.9, 8.5, 8.2, 8.4, 8.2],
                            borderColor: 'var(--success-color)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: 'var(--success-color)',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: {
                                        size: 12,
                                        weight: '500'
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: 'var(--primary-color)',
                                borderWidth: 1,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                min: 85,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Performance (%)',
                                    color: '#6b7280'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                min: 7,
                                max: 9,
                                title: {
                                    display: true,
                                    text: 'Fuel (MPG)',
                                    color: '#6b7280'
                                },
                                grid: {
                                    drawOnChartArea: false
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });
            }

            // Attendance Chart
            const attendanceCtx = document.getElementById('attendanceChart');
            if (attendanceCtx) {
                new Chart(attendanceCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
                        datasets: [{
                            label: 'Present',
                            data: [1235, 1228, 1240, 1232, 1225],
                            backgroundColor: 'var(--success-color)',
                            borderRadius: 8
                        }, {
                            label: 'Absent',
                            data: [12, 19, 7, 15, 22],
                            backgroundColor: 'var(--danger-color)',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Students'
                                }
                            }
                        }
                    }
                });
            }

            // Analytics Chart
            const analyticsCtx = document.getElementById('analyticsChart');
            if (analyticsCtx) {
                new Chart(analyticsCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'On-Time Performance (%)',
                            data: [92, 94, 91, 96, 93, 94.2],
                            borderColor: 'var(--success-color)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Fuel Efficiency (MPG)',
                            data: [8.1, 8.3, 7.9, 8.5, 8.0, 8.2],
                            borderColor: 'var(--primary-color)',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                min: 85,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Performance (%)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                min: 7,
                                max: 9,
                                title: {
                                    display: true,
                                    text: 'Fuel (MPG)'
                                },
                                grid: {
                                    drawOnChartArea: false
                                }
                            }
                        }
                    }
                });
            }
        }

        // Attendance Functions
        function markAllPresent() {
            if (confirm('Mark all students as present for today?\n\nThis will update attendance for all students currently on routes.')) {
                addNotification('success', 'Attendance Updated', 'All students marked as present for today.');

                // Update statistics
                document.querySelector('[data-metric="present"]').textContent = '1,247';
                document.querySelector('[data-metric="absent"]').textContent = '0';
                document.querySelector('[data-metric="attendance-rate"]').textContent = '100%';
            }
        }

        function takeAttendance() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">📋 Take Attendance</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="form-label">Select Route</label>
                            <select class="form-input" onchange="loadRouteStudents(this.value)">
                                <option value="">Choose Route</option>
                                <option value="5A">Route 5A - Lincoln Elementary</option>
                                <option value="3B">Route 3B - Washington High</option>
                                <option value="8C">Route 8C - Roosevelt Middle</option>
                                <option value="2A">Route 2A - Jefferson Elementary</option>
                            </select>
                        </div>
                        <div class="space-y-2" id="routeStudentsList">
                            <p class="text-gray-500 text-center py-4">Select a route to view students</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="submitAttendance(); this.closest('.modal').remove();" class="btn-primary flex-1">Submit Attendance</button>
                            <button onclick="this.closest('.modal').remove();" class="btn-secondary flex-1 bg-gray-300 text-gray-700">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function viewAbsentees() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">👥 Today's Absentees</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-red-50 rounded text-center">
                                <p class="text-sm text-gray-600">Total Absent</p>
                                <p class="text-2xl font-bold text-red-600">19</p>
                            </div>
                            <div class="p-3 bg-yellow-50 rounded text-center">
                                <p class="text-sm text-gray-600">Parents Notified</p>
                                <p class="text-2xl font-bold text-yellow-600">15</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="p-3 bg-red-50 border-l-4 border-red-500 rounded">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Michael Davis - Grade 4</p>
                                        <p class="text-sm text-gray-600">Route 3B • Stop 8</p>
                                    </div>
                                    <button class="btn-primary text-sm px-3 py-1" onclick="contactParent('STU002')">Contact</button>
                                </div>
                            </div>
                            <div class="p-3 bg-red-50 border-l-4 border-red-500 rounded">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Jessica Brown - Grade 3</p>
                                        <p class="text-sm text-gray-600">Route 5A • Stop 15</p>
                                    </div>
                                    <button class="btn-primary text-sm px-3 py-1" onclick="contactParent('STU004')">Contact</button>
                                </div>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove();" class="btn-primary w-full">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function sendNotifications() {
            if (confirm('Send attendance notifications to parents?\n\nThis will send:\n• Absence alerts to parents of absent students\n• Late arrival notifications\n• Daily attendance summary')) {
                addNotification('info', 'Notifications Sent', 'Attendance notifications sent to 127 parents.');
            }
        }

        function attendanceHistory() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">📅 Attendance History</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="p-3 bg-blue-50 rounded text-center">
                                <p class="text-sm text-gray-600">This Week</p>
                                <p class="text-xl font-bold text-blue-600">97.8%</p>
                            </div>
                            <div class="p-3 bg-green-50 rounded text-center">
                                <p class="text-sm text-gray-600">This Month</p>
                                <p class="text-xl font-bold text-green-600">98.2%</p>
                            </div>
                            <div class="p-3 bg-purple-50 rounded text-center">
                                <p class="text-sm text-gray-600">This Year</p>
                                <p class="text-xl font-bold text-purple-600">97.9%</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <p class="font-medium">Recent Trends:</p>
                            <div class="space-y-1 text-sm">
                                <div class="flex justify-between">
                                    <span>Monday</span>
                                    <span class="text-green-600">98.1%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Tuesday</span>
                                    <span class="text-green-600">97.9%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Wednesday</span>
                                    <span class="text-green-600">98.5%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Thursday</span>
                                    <span class="text-yellow-600">96.8%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Friday</span>
                                    <span class="text-green-600">98.5%</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove();" class="btn-primary w-full">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function filterByRoute(route) {
            // Filter route attendance display
            addNotification('info', 'Filter Applied', `Showing attendance for ${route || 'all routes'}.`);
        }

        function updateAttendanceChart(period) {
            addNotification('info', 'Chart Updated', `Attendance chart updated for ${period}.`);
        }

        function refreshAttendanceData() {
            addNotification('success', 'Data Refreshed', 'Attendance data has been refreshed with latest information.');
        }

        function filterAttendance(status) {
            // Filter attendance table
            const rows = document.querySelectorAll('#attendanceTable tr');
            rows.forEach(row => {
                if (status === '') {
                    row.style.display = '';
                } else {
                    const statusCell = row.querySelector('.px-2.py-1');
                    if (statusCell && statusCell.textContent.toLowerCase().includes(status)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        function viewStudentAttendance(studentId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">📊 Student Attendance History</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-medium">Emma Johnson (${studentId})</h4>
                            <p class="text-sm text-gray-600">Grade 5 • Route 5A • Stop 12</p>
                        </div>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="p-3 bg-green-50 rounded text-center">
                                <p class="text-sm text-gray-600">Present Days</p>
                                <p class="text-xl font-bold text-green-600">142</p>
                            </div>
                            <div class="p-3 bg-red-50 rounded text-center">
                                <p class="text-sm text-gray-600">Absent Days</p>
                                <p class="text-xl font-bold text-red-600">3</p>
                            </div>
                            <div class="p-3 bg-yellow-50 rounded text-center">
                                <p class="text-sm text-gray-600">Late Days</p>
                                <p class="text-xl font-bold text-yellow-600">2</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <p class="font-medium">Recent Activity:</p>
                            <div class="space-y-1 text-sm">
                                <div class="flex justify-between">
                                    <span>Today</span>
                                    <span class="text-green-600">Present (7:45 AM)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Yesterday</span>
                                    <span class="text-green-600">Present (7:42 AM)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Tuesday</span>
                                    <span class="text-green-600">Present (7:48 AM)</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove();" class="btn-primary w-full">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function contactParent(studentId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">📞 Contact Parent</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-medium">Parent Contact Information</h4>
                            <p class="text-sm text-gray-600">Jane Johnson • (555) 123-4567</p>
                            <p class="text-sm text-gray-600">jane.johnson@email.com</p>
                        </div>
                        <div class="space-y-3">
                            <button class="w-full p-3 text-left bg-green-50 border border-green-200 rounded-lg hover:bg-green-100" onclick="callParent('${studentId}')">
                                <div class="flex items-center space-x-3">
                                    <i data-feather="phone" class="w-5 h-5 text-green-600"></i>
                                    <span>Call Parent</span>
                                </div>
                            </button>
                            <button class="w-full p-3 text-left bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100" onclick="sendSMS('${studentId}')">
                                <div class="flex items-center space-x-3">
                                    <i data-feather="message-square" class="w-5 h-5 text-blue-600"></i>
                                    <span>Send SMS</span>
                                </div>
                            </button>
                            <button class="w-full p-3 text-left bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100" onclick="sendEmail('${studentId}')">
                                <div class="flex items-center space-x-3">
                                    <i data-feather="mail" class="w-5 h-5 text-purple-600"></i>
                                    <span>Send Email</span>
                                </div>
                            </button>
                        </div>
                        <button onclick="this.closest('.modal').remove();" class="btn-secondary w-full bg-gray-300 text-gray-700">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            feather.replace();
        }

        function markPresent(studentId) {
            if (confirm(`Mark student as present?\n\nThis will update today's attendance record.`)) {
                addNotification('success', 'Attendance Updated', 'Student marked as present.');

                // Update the row in the table
                const row = event.target.closest('tr');
                const statusCell = row.querySelector('.px-2.py-1');
                statusCell.className = 'px-2 py-1 text-xs rounded-full bg-green-100 text-green-800';
                statusCell.textContent = 'Present';

                // Update check-in time
                const timeCell = row.cells[4];
                timeCell.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                // Change action button
                event.target.textContent = 'Contact';
                event.target.className = 'text-green-600 hover:text-green-800';
                event.target.onclick = () => contactParent(studentId);
            }
        }

        function callParent(studentId) {
            alert('📞 Calling Parent...\n\nDialing (555) 123-4567\n\n[In a real system, this would initiate a phone call through the school\'s communication system]');
            addNotification('info', 'Call Initiated', 'Parent contact call has been initiated.');
        }

        function sendSMS(studentId) {
            alert('📱 SMS Sent!\n\nMessage: "Your child was absent from school today. Please contact the school office if this is an excused absence."\n\nSent to: (555) 123-4567');
            addNotification('success', 'SMS Sent', 'Attendance notification sent via SMS.');
        }

        function sendEmail(studentId) {
            alert('📧 Email Sent!\n\nSubject: "Student Attendance Notification"\n\nAn attendance notification email has been sent to the parent\'s registered email address.');
            addNotification('success', 'Email Sent', 'Attendance notification sent via email.');
        }

        function exportAttendanceReport(event) {
            event.preventDefault();
            const formData = new FormData(event.target);

            addNotification('success', 'Report Exported', 'Attendance report has been generated and downloaded.');
            closeModal('attendanceReportModal');
            event.target.reset();
        }

        function loadRouteStudents(route) {
            const container = document.getElementById('routeStudentsList');
            if (!route) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Select a route to view students</p>';
                return;
            }

            const students = {
                '5A': ['Emma Johnson', 'David Smith', 'Lisa Brown', 'Mike Wilson'],
                '3B': ['Michael Davis', 'Sarah Jones', 'Tom Anderson', 'Amy Taylor'],
                '8C': ['Jessica White', 'Chris Martin', 'Anna Garcia', 'Ryan Lee'],
                '2A': ['Sarah Wilson', 'Jake Thompson', 'Maria Rodriguez', 'Kevin Clark']
            };

            container.innerHTML = students[route].map(student => `
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                    <span>${student}</span>
                    <div class="flex space-x-2">
                        <button class="btn-success text-xs px-2 py-1" onclick="markStudentPresent('${student}')">Present</button>
                        <button class="btn-danger text-xs px-2 py-1" onclick="markStudentAbsent('${student}')">Absent</button>
                    </div>
                </div>
            `).join('');
        }

        function markStudentPresent(student) {
            event.target.style.opacity = '0.5';
            event.target.textContent = '✓';
            addNotification('info', 'Student Marked', `${student} marked as present.`);
        }

        function markStudentAbsent(student) {
            event.target.style.opacity = '0.5';
            event.target.textContent = '✗';
            addNotification('warning', 'Student Absent', `${student} marked as absent.`);
        }

        function submitAttendance() {
            addNotification('success', 'Attendance Submitted', 'Route attendance has been recorded successfully.');
        }

        // Logout Function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Redirect to login page
                window.location.href = '../index.html';
            }
        }

        // Real-time Updates
        function simulateRealTimeUpdates() {
            setInterval(() => {
                // Simulate random bus movements
                const busMarkers = document.querySelectorAll('.bus-marker');
                busMarkers.forEach(marker => {
                    const currentTop = parseInt(marker.style.top);
                    const currentLeft = parseInt(marker.style.left);

                    // Small random movement
                    const newTop = Math.max(10, Math.min(80, currentTop + (Math.random() - 0.5) * 10));
                    const newLeft = Math.max(10, Math.min(80, currentLeft + (Math.random() - 0.5) * 10));

                    marker.style.top = newTop + '%';
                    marker.style.left = newLeft + '%';
                });

                // Simulate metric updates
                if (Math.random() < 0.3) { // 30% chance
                    const metrics = ['activeBuses', 'studentsCount', 'onTimePerf', 'fuelEff'];
                    const randomMetric = metrics[Math.floor(Math.random() * metrics.length)];
                    const element = document.getElementById(randomMetric);

                    if (element) {
                        element.style.animation = 'pulse 1s ease-in-out';
                        setTimeout(() => {
                            element.style.animation = '';
                        }, 1000);
                    }
                }
            }, 5000); // Update every 5 seconds
        }

        // Initialize Map
        function initializeMap() {
            const mapElement = document.getElementById('liveMap');
            if (mapElement && typeof L !== 'undefined') {
                // Initialize Leaflet map
                const map = L.map(mapElement).setView([40.7128, -74.0060], 12); // Default center (New York City)

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 18,
                }).addTo(map);

                // Add bus markers
                const buses = [
                    { lat: 40.7128, lng: -74.0060, id: 'Bus #001', route: 'Route 5A' },
                    { lat: 40.7138, lng: -74.0070, id: 'Bus #002', route: 'Route 3B' },
                    { lat: 40.7118, lng: -74.0050, id: 'Bus #003', route: 'Route 8C' },
                    { lat: 40.7148, lng: -74.0080, id: 'Bus #004', route: 'Route 2A' },
                    { lat: 40.7108, lng: -74.0040, id: 'Bus #005', route: 'Route 7D' }
                ];

                buses.forEach(bus => {
                    // Create custom icon
                    const busIcon = L.divIcon({
                        html: `
                            <div style="background-color: #10B981; border: 2px solid white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 12h8M12 8v8" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                        `,
                        className: 'custom-bus-icon',
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    });

                    const marker = L.marker([bus.lat, bus.lng], { icon: busIcon }).addTo(map);

                    // Add popup
                    marker.bindPopup(`
                        <div style="font-family: Arial, sans-serif; max-width: 200px;">
                            <h4 style="margin: 0 0 8px 0; color: #2563EB;">${bus.id}</h4>
                            <p style="margin: 0; color: #6B7280;">Route: ${bus.route}</p>
                            <p style="margin: 4px 0 0 0; color: #10B981;">● Active</p>
                        </div>
                    `);
                });

                console.log('Live Fleet Map initialized successfully with Leaflet');
            } else {
                console.warn('Leaflet not loaded.');
                // Fallback: Show a placeholder
                mapElement.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f3f4f6; border-radius: 8px; color: #6b7280;">
                        <div style="text-align: center;">
                            <i data-feather="map" style="width: 48px; height: 48px; margin-bottom: 16px;"></i>
                            <p style="margin: 0; font-size: 16px; font-weight: 500;">Map Loading...</p>
                            <p style="margin: 8px 0 0 0; font-size: 14px;">Please ensure Leaflet is loaded</p>
                        </div>
                    </div>
                `;
                feather.replace();
            }
        }

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function () {
            feather.replace();
            initializeCharts();
            initializeMap();
            simulateRealTimeUpdates();

            // Add some initial notifications
            addNotification('warning', 'Route 3B Delayed', '15 minutes behind schedule due to traffic');
            addNotification('info', 'New Driver Application', 'Sarah Johnson submitted application for review');
            addNotification('success', 'Maintenance Complete', 'Bus #15 maintenance completed successfully');

            // Close modals when clicking outside
            document.addEventListener('click', function (e) {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('active');
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 'k':
                            e.preventDefault();
                            document.querySelector('input[placeholder="Search..."]')?.focus();
                            break;
                        case 'b':
                            e.preventDefault();
                            toggleSidebar();
                            break;
                    }
                }

                if (e.key === 'Escape') {
                    closeSidebar();
                    closeNotifications();
                    // Close any open modals
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
            });
        });
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'97f78eea613b8e3a',t:'MTc1NzkzMzM3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>